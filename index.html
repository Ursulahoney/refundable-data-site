<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Refund Opportunities</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        max-width: 1100px;
        margin: 0 auto;
        padding: 1rem 1.5rem;
      }
      h1 {
        margin-bottom: 1rem;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        table-layout: fixed;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 6px;
        vertical-align: top;
        font-size: 0.9rem;
        word-wrap: break-word;
      }
      th {
        background: #f5f5f5;
        text-align: left;
      }
      a {
        text-decoration: none;
      }
    </style>

    <!-- CSV parser so commas inside text don't break the table -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  </head>
  <body>
    <h1>Refund Opportunities</h1>
    <table id="results"></table>

    <script>
      const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXzaJTWFPZp14JeAWkVsXgua5yclwwbmwRqgKpOzj6MFD7XcB1dJhWsEJdwh6nbB2K7VIGPYw8j8NO/pub?gid=1266693431&single=true&output=csv"; // <-- paste the public_view CSV link here

      async function loadData() {
        const res = await fetch(CSV_URL);
        const text = await res.text();

        // Parse CSV safely (handles commas inside quotes)
        const parsed = Papa.parse(text.trim(), { header: true });
const rows = parsed.data;   // no filter

        // Choose which columns to show and labels
        const columns = ["date_found", "state", "category", "title", "who_is_eligible", "apply_url"];
        const labels = {
          date_found: "Found",
          state: "State",
          category: "Category",
          title: "Title",
          who_is_eligible: "Who is eligible",
          apply_url: "Claim link"
        };

        const table = document.getElementById("results");
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        columns.forEach(col => {
          const th = document.createElement("th");
          th.textContent = labels[col];
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");

        rows.forEach(row => {
          const tr = document.createElement("tr");
          columns.forEach(col => {
            const td = document.createElement("td");

            if (col === "apply_url" && row[col]) {
              const link = document.createElement("a");
              link.href = row[col];
              link.target = "_blank";
              link.rel = "noopener noreferrer";
              link.textContent = "Go to site";
              td.appendChild(link);
            } else {
              td.textContent = row[col] || "";
            }

            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
      }

      loadData();
    </script>
  </body>
</html>
