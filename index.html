<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQXzaJTWFPZp14JeAWkVsXgua5yclwwbmwRqgKpOzj6MFD7XcB1dJhWsEJdwh6nbB2K7VIGPYw8j8NO/pub?gid=1266693431&single=true&output=csv";

  async function loadData() {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const parsed = Papa.parse(text.trim(), { header: true });

    const rows = parsed.data.filter(r =>
      Object.values(r).some(v => v && String(v).trim() !== "")
    );

    // Use your exact sheet column names
    const columns = [
      "id",
      "state",
      "category",
      "title",
      "description",
      "claim_url"
    ];

    const labels = {
      id: "Found",
      state: "State",
      category: "Category",
      title: "Title",
      description: "Who is eligible",
      claim_url: "Claim link"
    };

    const table = document.getElementById("results");
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");

    columns.forEach(col => {
      const th = document.createElement("th");
      th.textContent = labels[col];
      headerRow.appendChild(th);
    });

    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    rows.forEach(row => {
      const tr = document.createElement("tr");

      columns.forEach(col => {
        const td = document.createElement("td");

        if (col === "claim_url" && row[col]) {
          const link = document.createElement("a");
          link.href = row[col];
          link.target = "_blank";
          link.textContent = "Go to site";
          td.appendChild(link);
        } else {
          td.textContent = row[col] || "";
        }

        tr.appendChild(td);
      });

      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
  }

  loadData();
</script>
